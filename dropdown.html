<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">

   
      <script type = "text/javascript" src = "https://www.gstatic.com/charts/loader.js">
      </script>
      <script type = "text/javascript">
         google.charts.load('current', {packages: ['corechart']});     
      </script>

<style>
.dropbtn {
  background-color: #3498DB;
  color: white;
  padding: 16px;
  font-size: 16px;
  border: none;
  cursor: pointer;
}

.dropbtn:hover, .dropbtn:focus {
  background-color: #2980B9;
}

.dropdown {
  position: relative;
  display: inline-block;
}

.dropdown-content {
  display: none;
  position: relative;
  background-color: #f1f1f1;
  min-width: 160px;
  overflow: auto;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 1;
}

.dropdown-content a {
  color: black;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
}

.dropdown a:hover {background-color: #ddd;}

.show {display: block;}
<title>Worker Friendliness Index</title>
</style>
</head>
<body onload="listLanguage()">
<center>
<h2>Worker Friendliness Index</h2>
<p><!--Click on the button to open the dropdown menu.--></p>

  	<!--
    <a href="#home">Home</a>
    <a href="#about">About</a>
    <a href="#contact">Contact</a>
	-->
	
	<div class="container" id="languages"></div>
	

<p>

  	<!--
    <a href="#home">Home</a>
    <a href="#about">About</a>
    <a href="#contact">Contact</a>
	-->
	
	<div class="container" id="CBA_list"></div>

<p>
<div class="container" id="metrics"></div>	
	
<div class="container" id="graph"></div>	
<div id = "container" style = "width: 550px; height: 400px; margin: 0 auto">
<div>
  <canvas id="myChart"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</center>
<script>
/* When the user clicks on the button, 
toggle between hiding and showing the dropdown content */
function myFunction() {
  document.getElementById("myDropdown").classList.toggle("show");
}
function myFunction2() {
  document.getElementById("myDropdown2").classList.toggle("show");
}
// Close the dropdown if the user clicks outside of it
window.onclick = function(event) {
  if (!event.target.matches('.dropbtn')) {
    var dropdowns = document.getElementsByClassName("dropdown-content");
    var i;
    for (i = 0; i < dropdowns.length; i++) {
      var openDropdown = dropdowns[i];
      if (openDropdown.classList.contains('show')) {
        openDropdown.classList.remove('show');
      }
    }
  }
}

function listLanguage() {
  	var url="https://raw.githubusercontent.com/osama-khalid/DHH21/main/CBA_Map.csv";
  	function httpGet(theUrl)
    {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open( "GET", theUrl, false ); // false for synchronous request
        xmlHttp.send( null );
        return xmlHttp.responseText;
    }
	function onlyUnique(value, index, self) {
	  return self.indexOf(value) === index;
	}
    var rawText= httpGet(url);
    langs=[];
    var text=rawText.split('\n')
    for (k=0;k<text.length;k++) {
    	row = text[k].split('\t')[3];
    	
    	langs.push(row)
    	
    }
    var unique = langs.filter(onlyUnique)
    
    str=''
    for (k=0;k<unique.length-1;k++){
		//str=str+'<button type="button" class="btn" onclick="getCBA('+"'"+unique[k].toUpperCase()+"'"+")>"+unique[k].toUpperCase()+'</button>'
    	str=str+'<a href="#" onclick="getCBA('+"'"+unique[k].toUpperCase()+"'"+')">'+ unique[k].toUpperCase()+'</a>'
    }
    //console.log(str)
    str='<div class="dropdown"><button onclick="myFunction()" class="dropbtn">Languages</button><div id="myDropdown" class="dropdown-content">'+str+'</div></div></div>'

//str='<a href="#home">Home</a>\n<a href="#about">CH</a>\n<a href="#contact">FR</a>\n'
	document.getElementById("languages").innerHTML = str
}

function getCBA(lang){
	console.log(lang)
	var url="https://raw.githubusercontent.com/osama-khalid/DHH21/main/CBA_Map.csv";
  	function httpGet(theUrl)
    {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open( "GET", theUrl, false ); // false for synchronous request
        xmlHttp.send( null );
        return xmlHttp.responseText;
    }
	
    var rawText= httpGet(url);
    CBAs=[];
    var text=rawText.split('\n')
    for (k=0;k<text.length-1;k++) {
    	row = text[k].split('\t');
    	if (row[3].toUpperCase()==lang){
    		CBAs.push(row[0])
    	}
    	
    }
	str=''
    for (k=0;k<CBAs.length;k++){
		//str=str+'<button type="button" class="btn" onclick="getCBA('+"'"+unique[k].toUpperCase()+"'"+")>"+unique[k].toUpperCase()+'</button>'
    	str=str+'<a href="#" onclick="showMetric('+"'"+CBAs[k]+"'"+')">'+ CBAs[k]+'</a>'
    }
    //console.log(str)
    str='<div class="dropdown"><button onclick="myFunction2()" class="dropbtn">CBAs</button><div id="myDropdown2" class="dropdown-content">'+str+'</div></div></div>'
    document.getElementById("CBA_list").innerHTML = str
}

function showMetric(CBA){
	console.log(CBA)
	//document.getElementById("demo").innerHTML = "";
	//document.getElementById("languages").innerHTML = "";
	//document.getElementById("CBA_list").innerHTML = "";

	var url="https://raw.githubusercontent.com/osama-khalid/DHH21/main/CBA_Map.csv";

  	function httpGet(theUrl)
    {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open( "GET", theUrl, false ); // false for synchronous request
        xmlHttp.send( null );
        return xmlHttp.responseText;
    }
	
    var rawText= httpGet(url);
    
    var text=rawText.split('\n')

    for (k=0;k<text.length-1;k++) {
    	row = text[k].split('\t');
    	if (row[0]==CBA){
    		data=row
    	}
    	
    }
    console.log(data[0])
    console.log(1)

    var Title=data[0];
    var cba_id=data[1];
    //console.log(cba_id)
    //console.log(1)    
    var country=data[2]
    var lang=data[3]
    var year=data[4]
    access=['',0,0]
    //Accessibility
    var url="https://raw.githubusercontent.com/osama-khalid/DHH21/main/CBA_accessibility.csv";
	var rawText= httpGet(url);
    var text=rawText.split('\n')
	
    for (k=0;k<text.length-1;k++) {
    	row = text[k].split('\t');
    	
    	//console.log(row[0]==data[1])
    	if (row[0]==cba_id){
    		
    		access=row
    	}
    	
    }
    readability=access[2]
    lexDiv=access[3]
    accs=access[4]
    console.log(access)
    otime=['',0,0,0,0]

    var url='https://raw.githubusercontent.com/osama-khalid/DHH21/main/CBA_over.csv'
	//var url="https://raw.githubusercontent.com/osama-khalid/DHH21/main/CBA_accessibility.csv";
	var rawText= httpGet(url);
    var text=rawText.split('\n')
	
    for (k=0;k<text.length-1;k++) {
    	row = text[k].split('\t');
    	
    	//console.log(row[0]==data[1])
    	if (row[0]==cba_id){
    		
    		otime=row
    	}
    	
    }
    overtime=otime[1]
    annuleav=otime[2]	
    ALs=otime[3]
    comp_scores=otime[4]
    console.log(otime)
    str='<b>Title of CBA: </b>'+Title+'<br><br><br><b>Country: </b>'+country+'<br><b>Language: </b>'+lang+'<br><b>Year: </b>'+year+'<br><br><br><b>Accessible Language: </b>'+accs+'<br><br><b>Readability: </b>'+readability+'<br><b>Lexical Diversity: </b>'+lexDiv+'<br><br><br><b>OverTime/AnnualLeave: </b>'+comp_scores+'<br><br><b>OverTime: </b>'+overtime+'<br><b>Annual Leave: </b>'+annuleav+'<br><b>ALs: </b>'+ALs+'<br>'
    
    drawChart(accs,readability,lexDiv,comp_scores,overtime,annuleav,ALs);
    document.getElementById("metrics").innerHTML = str
}
function drawChart(accs,readability,lexDiv,comp_scores,overtime,annuleav,ALs) {
            // Define the chart to be drawn.
            var data = google.visualization.arrayToDataTable([
               ['', ''],
               ['Language Accessibility',  parseFloat(accs)],
               ['Readability',  parseFloat(readability)],
               ['Lexical Diversity',  parseFloat(lexDiv)],
               ['OverTime/AnnualLeave',  parseFloat(comp_scores)],
               ['OverTime',  parseFloat(overtime)],
               ['Annual Leave',  parseFloat(annuleav)],
               ['ALs',  parseFloat(overtime)]
            ]);

            var options = {title: 'Worker Friendliness Index',hAxis: {
            	title :'Score',
    viewWindow: {
        min: 0,
        max: 5
    },
    ticks: [0, 1, 2, 3, 4,5] // display labels every 25
}
 ,vAxis: { 
             title :'Metrics'}
				}; 

            // Instantiate and draw the chart.
            var chart = new google.visualization.BarChart(document.getElementById('container'));
     
            chart.draw(data, options);
         }



function chart(accs,readability,lexDiv,comp_scores,overtime,annuleav,ALs){
const labels = [
  'Language Accessibility',
  'Readability',
  'Lexical Diversity',
  'OverTime/AnnualLeave',
  'OverTime',
  'Annual Leave',
  'ALs',
];
const data = {
  labels: labels,
  datasets: [{
    label: 'Worker Friendliness Index',
    backgroundColor: 'rgb(255, 99, 132)',
    borderColor: 'rgb(255, 99, 132)',
    data: [accs,readability,lexDiv,comp_scores,overtime,annuleav,ALs],
  }]
};

 const config = {
  type: 'bar',
  data,
  options: {}
};

  var myChart = new Chart(
    document.getElementById('myChart'),
    config
  );         
}
</script>

</body>
</html>
